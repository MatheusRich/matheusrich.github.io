<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>The Rubygemsâ€™ web command | Matheus Richard</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="The Rubygemsâ€™ web command" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Wow! GSoC is almost on the final evaluation period! Time really flied! I think itâ€™s a good moment to talk a bit about my work." />
<meta property="og:description" content="Wow! GSoC is almost on the final evaluation period! Time really flied! I think itâ€™s a good moment to talk a bit about my work." />
<link rel="canonical" href="http://matheusrich.github.io/rubygems-web-command" />
<meta property="og:url" content="http://matheusrich.github.io/rubygems-web-command" />
<meta property="og:site_name" content="Matheus Richard" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-20T22:00:00-03:00" />
<script type="application/ld+json">
{"description":"Wow! GSoC is almost on the final evaluation period! Time really flied! I think itâ€™s a good moment to talk a bit about my work.","mainEntityOfPage":{"@type":"WebPage","@id":"http://matheusrich.github.io/rubygems-web-command"},"@type":"BlogPosting","url":"http://matheusrich.github.io/rubygems-web-command","headline":"The Rubygemsâ€™ web command","dateModified":"2019-08-20T22:00:00-03:00","datePublished":"2019-08-20T22:00:00-03:00","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://matheusrich.github.io/feed.xml" title="Matheus Richard" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Matheus Richard</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">The Rubygems&#39; web command</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2019-08-20T22:00:00-03:00" itemprop="datePublished">Aug 20, 2019
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Wow! GSoC is almost on the final evaluation period! Time really flied! I think itâ€™s a good moment to talk a bit about my work.</p>

<p>As I mentioned in <a href="/me-and-gsoc">this post</a>, Iâ€™m working with Rubygems for GSoC 2019. <a href="https://github.com/rubygems/rubygems/pull/2835">My Pull Request</a> is still open, but I think itâ€™s stable enough to write about it (and the process of opening it).</p>

<p>Iâ€™ve added a new command to Rubygems: the <code class="highlighter-rouge">web</code> command. Its goal is to help developers to quickly find documentation about a particular gem.</p>

<h1 id="how-does-it-look">How does it look?</h1>

<p>Itâ€™s really simple to use this command. Take a look:</p>

<ul>
  <li>
    <p><strong>Do you wanna know what is the homepage for some gem?</strong> Just type <code class="highlighter-rouge">gem web gem_name</code> and it will output the URL.</p>
  </li>
  <li>
    <p><strong>Quickly access to the rubygems page?</strong> <code class="highlighter-rouge">gem web -r gem_name</code> brings it.</p>
  </li>
  <li>
    <p><strong>Canâ€™t remember what <em>that</em> method does?</strong> <code class="highlighter-rouge">gem web -d gem_name</code> will get the documentation URL for you.</p>
  </li>
  <li>
    <p><strong>Want to dive into that good old messy code?</strong> Type <code class="highlighter-rouge">gem web -c gem_name</code> to get its source code.</p>
  </li>
  <li>
    <p><strong>I know, weâ€™re too lazy to copy/paste the link:</strong> Just set the environment variable <code class="highlighter-rouge">BROWSER</code> (e.g. <code class="highlighter-rouge">export BROWSER=google-chrome</code>) and it will automatically open the URL in the browser for you. (Pay <a href="https://github.com/rubygems/rubygems/pull/2835#issuecomment-512542718">AndrÃ© Arko</a> a beer for this suggestion ðŸ˜œ)</p>
  </li>
</ul>

<h1 id="whats-happening-under-the-hood">Whatâ€™s happening under the hood?</h1>
<p>Adding a new method for Rubygems is not rocket science (I have a post on <a href="/how-rubygems-commands-work">how to do it</a>). Iâ€™ll explain here a bit of how the <code class="highlighter-rouge">web</code> command works (I will be short on some sections to keep this clearer).</p>

<p>The first thing this commands does when itâ€™s called is to run the method <code class="highlighter-rouge">open_page(gem, options)</code> from <code class="highlighter-rouge">Gem::Web::Executor</code>.</p>

<p>The method will try to find locally a gemspec of the gem youâ€™ve typed with:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">spec</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">Specification</span><span class="p">.</span><span class="nf">find_by_name</span><span class="p">(</span><span class="n">gem</span><span class="p">)</span></code></pre></figure>

<p>The gemspec is important because it has all the info we need (homepage, documentation URI etc).</p>

<blockquote>
  <p>This was one of the differences between the <a href="https://github.com/bitboxer/gem-web">original implementation</a> of <code class="highlighter-rouge">gem-web</code> and mine. It was also a suggestion from the community, for <a href="https://github.com/rubygems/rubygems/pull/2835#issuecomment-512256175">security reasons</a>.</p>
</blockquote>

<p>If the gem is not installed, a <code class="highlighter-rouge">Gem::MissingSpecError</code> will be raised. In this case we have to search on the Rubygems API to find the gemspec.</p>

<p>The method <code class="highlighter-rouge">fetch_remote_spec(gem)</code> is responsible to fetch a remote gemspec (if the gem exists):</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">fetch_remote_spec</span><span class="p">(</span><span class="n">gem</span><span class="p">)</span>
  <span class="n">dep</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">Dependency</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">gem</span><span class="p">)</span>
  <span class="n">found</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">SpecFetcher</span><span class="p">.</span><span class="nf">fetcher</span><span class="p">.</span><span class="nf">spec_for_dependency</span><span class="p">(</span><span class="n">dep</span><span class="p">)</span> <span class="c1"># Here's the request</span>
  <span class="o">...</span>
<span class="k">end</span></code></pre></figure>

<p>If everything went well, we should have the gem specification now (otherwise it will output an error message). Now the command see what options the user selected (homepage, rubygems page, source code or documentation) and calls <code class="highlighter-rouge">open_browser(uri)</code>.</p>

<p>I think the implementation of this method is really simple, take a look:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">def</span> <span class="nf">open_browser</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
  <span class="n">browser</span> <span class="o">=</span> <span class="no">ENV</span><span class="p">[</span><span class="s2">"BROWSER"</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">browser</span><span class="p">.</span><span class="nf">nil?</span> <span class="o">||</span> <span class="n">browser</span><span class="p">.</span><span class="nf">empty?</span>
    <span class="nb">puts</span> <span class="n">uri</span>
  <span class="k">else</span>
    <span class="nb">system</span><span class="p">(</span><span class="n">browser</span><span class="p">,</span> <span class="n">uri</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure>

<p>If the <code class="highlighter-rouge">BROWSER</code> environment variable is set, the command uses it to open your browser with the link. Else, it juts prints the URI. Pretty easy, right?</p>

<p><img style="display: block; margin: 0 auto;" src="/img/goddamn-right.gif" /></p>

<h1 id="the-end">The End</h1>
<p>Well, thatâ€™s it! I told you that it wasnâ€™t hard at all. This was one of the last posts Iâ€™ll do about my work on GSoC, since itâ€™s getting to the end. In the next update Iâ€™ll talk about the <a href="/lessons-learned-on-gsoc-2019">lessons Iâ€™ve learned</a> while contributing for Rubygems. â€˜Till next time, folks!</p>


  </div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'http://matheusrich.github.io/rubygems-web-command';
      this.page.identifier = 'http://matheusrich.github.io/rubygems-web-command';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://matheusrich.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/rubygems-web-command" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Matheus Richard</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Matheus Richard</li><li><a class="u-email" href="mailto:matheusrichardt@gmail.com">matheusrichardt@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/matheusrich"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">matheusrich</span></a></li><li><a href="https://instagram.com/matheusrichardt"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#instagram"></use></svg> <span class="username">matheusrichardt</span></a></li><li><a href="https://www.linkedin.com/in/matheus-richard"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">matheus-richard</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Hi, I&#39;m Matheus Richard, a Software Engineering Student at UnB (Brazil). I&#39;m an open source dev, I love music and my newfound passion is game development.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
